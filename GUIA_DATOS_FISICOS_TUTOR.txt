# ğŸ¥Š GUÃA COMPLETA: DATOS FÃSICOS Y DE TUTOR PARA ATLETAS

## ğŸ“‹ **FLUJO COMPLETO DEL SISTEMA:**

### **1. âœ… Registro del Atleta**
- Atleta se registra con email, password, nombre, rol: "Atleta"
- Estado inicial: `estado_atleta = "pendiente_datos"`
- `datos_fisicos_capturados = false`

### **2. âœ… VerificaciÃ³n de Email**
- Atleta confirma su email con el token de 6 dÃ­gitos
- Email queda verificado: `email_verificado = true`

### **3. âœ… VinculaciÃ³n con Gimnasio**
- Atleta ingresa la clave del gimnasio
- Se crea relaciÃ³n en `user_gym_relations`
- Se crea solicitud en `data_capture_requests`

### **4. âœ… Coach Aprueba y Captura Datos**
- Coach ve atleta pendiente en su lista
- Coach ejecuta `POST /atletas/{atletaId}/aprobar`
- Se capturan datos fÃ­sicos y de tutor
- Atleta queda aprobado: `estado_atleta = "activo"`

---

## ğŸ¯ **ENDPOINTS DISPONIBLES:**

### **âœ… 1. Debug del Coach (NUEVO)**
```bash
GET /identity/v1/atletas/debug/coach-status
Authorization: Bearer <coach_token>
```

**Respuesta esperada:**
```json
{
  "coach": {
    "id": "coach-id",
    "email": "coach@email.com",
    "nombre": "Coach Name",
    "rol": "Entrenador",
    "estadoAtleta": "activo",
    "datosFisicosCapturados": true
  },
  "solicitudesPendientes": [
    {
      "id": "solicitud-id",
      "atletaId": "atleta-id",
      "coachId": "coach-id",
      "status": "PENDIENTE",
      "nombreAtleta": "Atleta Name",
      "emailAtleta": "atleta@email.com"
    }
  ],
  "totalSolicitudes": 1
}
```

### **âœ… 2. Aprobar Atleta**
```bash
POST /identity/v1/atletas/{atletaId}/aprobar
Authorization: Bearer <coach_token>
Content-Type: application/json

{
  "nivel": "principiante",
  "alturaCm": 170,
  "pesoKg": 70,
  "guardia": "orthodox",
  "alergias": "Ninguna",
  "contactoEmergenciaNombre": "Juan PÃ©rez",
  "contactoEmergenciaTelefono": "1234567890"
}
```

**Respuesta esperada:**
```json
{
  "mensaje": "Atleta aprobado y perfil actualizado con Ã©xito."
}
```

### **âœ… 3. Consultar Solicitudes Pendientes**
```bash
GET /identity/v1/requests/pending
Authorization: Bearer <coach_token>
```

**Respuesta esperada:**
```json
[
  {
    "id": "atleta-id",
    "email": "atleta@email.com",
    "nombre": "Atleta Name",
    "rol": "Atleta",
    "estado_atleta": "pendiente_datos",
    "datos_fisicos_capturados": false
  }
]
```

---

## ğŸ§ª **DATOS QUE SE CAPTURAN:**

### **ğŸ“Š Datos FÃ­sicos (OBLIGATORIOS):**
```json
{
  "nivel": "string",           // "principiante", "intermedio", "avanzado"
  "alturaCm": "number",        // Altura en centÃ­metros
  "pesoKg": "number"          // Peso en kilogramos
}
```

### **ğŸ“Š Datos FÃ­sicos (OPCIONALES):**
```json
{
  "guardia": "string",         // "orthodox", "southpaw"
  "alergias": "string"         // DescripciÃ³n de alergias
}
```

### **ğŸ“ Datos de Tutor (OPCIONALES):**
```json
{
  "contactoEmergenciaNombre": "string",    // Nombre del contacto
  "contactoEmergenciaTelefono": "string"   // TelÃ©fono del contacto
}
```

---

## ğŸ” **DIAGNÃ“STICO DE PROBLEMAS:**

### **âŒ Problema: Coach no puede aprobar atletas**

**Verificar con el endpoint de debug:**
```bash
GET /identity/v1/atletas/debug/coach-status
Authorization: Bearer <coach_token>
```

**Posibles causas:**
1. **Coach no estÃ¡ activo:** `estadoAtleta !== "activo"`
2. **No hay solicitudes pendientes:** `totalSolicitudes === 0`
3. **Coach no tiene permisos:** `rol !== "Entrenador"`

### **âŒ Problema: Error 403 al aprobar**

**Verificar:**
1. **Token vÃ¡lido:** Coach debe estar autenticado
2. **Coach activo:** `estadoAtleta === "activo"`
3. **Solicitud existe:** Debe haber una solicitud pendiente
4. **Permisos correctos:** Coach debe ser dueÃ±o de la solicitud

### **âŒ Problema: No aparecen atletas pendientes**

**Verificar:**
1. **Atletas registrados:** Deben existir atletas en la base de datos
2. **Atletas vinculados:** Deben estar vinculados al gimnasio del coach
3. **Solicitudes creadas:** Debe haber solicitudes en `data_capture_requests`

---

## ğŸš€ **PASOS PARA PROBAR:**

### **1. Verificar estado del coach:**
```bash
GET /identity/v1/atletas/debug/coach-status
Authorization: Bearer <coach_token>
```

### **2. Verificar atletas pendientes:**
```bash
GET /identity/v1/requests/pending
Authorization: Bearer <coach_token>
```

### **3. Aprobar un atleta:**
```bash
POST /identity/v1/atletas/{atletaId}/aprobar
Authorization: Bearer <coach_token>
Content-Type: application/json

{
  "nivel": "principiante",
  "alturaCm": 170,
  "pesoKg": 70,
  "guardia": "orthodox",
  "alergias": "Ninguna",
  "contactoEmergenciaNombre": "Juan PÃ©rez",
  "contactoEmergenciaTelefono": "1234567890"
}
```

---

## ğŸ“‹ **ESTADOS DEL ATLETA:**

### **ğŸ”„ Estados posibles:**
- **`pendiente_datos`:** Atleta registrado pero sin datos fÃ­sicos
- **`activo`:** Atleta aprobado con datos fÃ­sicos completos

### **âœ… Transiciones:**
1. **Registro:** `pendiente_datos` â†’ Coach debe aprobar
2. **AprobaciÃ³n:** `pendiente_datos` â†’ `activo` (con datos fÃ­sicos)

---

## ğŸ¯ **RESUMEN DEL FLUJO:**

### **âœ… Para el Frontend:**
1. **Coach hace login** â†’ Se activa automÃ¡ticamente
2. **Coach consulta pendientes** â†’ `GET /requests/pending`
3. **Coach aprueba atleta** â†’ `POST /atletas/{atletaId}/aprobar`
4. **Atleta queda activo** â†’ Puede usar la app normalmente

### **âœ… Para el Backend:**
1. **Auto-fix activa coaches** â†’ En login y /me
2. **Solicitudes se crean** â†’ Al vincular con gimnasio
3. **Datos se guardan** â†’ En tabla `athletes`
4. **Estado se actualiza** â†’ `estado_atleta = "activo"`

**Â¡El sistema estÃ¡ completamente implementado y listo! ğŸš€** 