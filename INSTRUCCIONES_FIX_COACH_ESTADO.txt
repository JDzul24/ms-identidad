# ğŸ¯ INSTRUCCIONES PARA FRONTEND - FIX COACH ESTADO

## âœ… **PROBLEMA RESUELTO EN BACKEND**

### **ğŸ”§ Cambios implementados:**

1. **âœ… Coaches se crean automÃ¡ticamente activos**
   - `Entrenador` y `Admin` â†’ `estado_atleta: 'activo'`
   - `Atleta` â†’ `estado_atleta: 'pendiente_datos'`

2. **âœ… Permisos corregidos**
   - Ahora tanto `Entrenador` como `Admin` pueden aprobar atletas
   - ValidaciÃ³n de estado activo antes de aprobar

3. **âœ… Validaciones mejoradas**
   - VerificaciÃ³n de que el coach estÃ© activo
   - VerificaciÃ³n de rol correcto

---

## ğŸš€ **FLUJO CORREGIDO**

### **Antes (âŒ Problema):**
```
Coach se registra â†’ Coach queda "pendiente_datos" â†’ Error 403 al aprobar atletas
```

### **Ahora (âœ… Solucionado):**
```
Coach se registra â†’ Coach automÃ¡ticamente "activo" â†’ Puede aprobar atletas âœ…
```

---

## ğŸ§ª **PRUEBAS PARA EL FRONTEND**

### **1. Registro de Coach:**
```bash
POST /identity/v1/auth/register
{
  "email": "coach@test.com",
  "password": "password123",
  "nombre": "Coach Test",
  "rol": "Entrenador"
}
```

**Respuesta esperada:**
```json
{
  "id": "user-id",
  "email": "coach@test.com",
  "gymnarium": null
}
```

### **2. Login de Coach:**
```bash
POST /identity/v1/oauth/token
{
  "grant_type": "password",
  "client_id": "capbox-mobile-app",
  "client_secret": "capbox-secret-key-2024",
  "username": "coach@test.com",
  "password": "password123"
}
```

**Respuesta esperada:**
```json
{
  "access_token": "jwt-token",
  "refresh_token": "refresh-token"
}
```

### **3. Aprobar Atleta (ahora funciona):**
```bash
POST /identity/v1/atletas/{atletaId}/aprobar
Authorization: Bearer <jwt_token>
{
  "nivel": "principiante",
  "alturaCm": 170,
  "pesoKg": 70,
  "guardia": "orthodox",
  "alergias": "Ninguna",
  "contactoEmergenciaNombre": "Juan PÃ©rez",
  "contactoEmergenciaTelefono": "1234567890"
}
```

**Respuesta esperada:**
```json
{
  "mensaje": "Atleta aprobado y perfil actualizado con Ã©xito."
}
```

---

## ğŸ¯ **CAMBIOS EN EL FRONTEND**

### **âœ… NO SE REQUIEREN CAMBIOS EN EL FRONTEND**

El frontend puede seguir usando exactamente la misma lÃ³gica:

1. **Registro de coach** â†’ Funciona igual
2. **Login de coach** â†’ Funciona igual  
3. **Aprobar atletas** â†’ Ahora funciona correctamente

### **ğŸ” Verificaciones que puede hacer el frontend:**

1. **DespuÃ©s del registro de coach:**
   - Verificar que no aparece mensaje "pendiente de datos"
   - Coach debe poder acceder a todas las funciones

2. **DespuÃ©s del login de coach:**
   - Verificar que el estado es "activo"
   - Coach debe poder aprobar atletas

3. **Al aprobar atletas:**
   - Ya no debe recibir Error 403
   - Debe recibir respuesta exitosa

---

## ğŸš¨ **SI AÃšN HAY PROBLEMAS**

### **Para coaches existentes (registrados antes de la correcciÃ³n):**

El backend incluye un script SQL para corregir coaches existentes:

```sql
-- Ejecutar en la base de datos
UPDATE users 
SET estado_atleta = 'activo',
    datos_fisicos_capturados = true,
    fecha_aprobacion = NOW()
WHERE role IN ('Entrenador', 'Admin')
AND estado_atleta = 'pendiente_datos';
```

### **VerificaciÃ³n manual:**
```bash
# Verificar estado del coach
GET /identity/v1/usuarios/me
Authorization: Bearer <coach_token>

# Respuesta esperada:
{
  "id": "coach-id",
  "email": "coach@test.com",
  "nombre": "Coach Test",
  "rol": "Entrenador",
  "estado_atleta": "activo",  // â† Debe ser "activo"
  "datos_fisicos_capturados": true
}
```

---

## âœ… **CHECKLIST DE VERIFICACIÃ“N**

### **Para el Frontend:**
- [ ] âœ… Coach se registra sin problemas
- [ ] âœ… Coach puede hacer login
- [ ] âœ… Coach no ve mensaje "pendiente de datos"
- [ ] âœ… Coach puede aprobar atletas sin Error 403
- [ ] âœ… Atletas quedan en estado "pendiente_datos"
- [ ] âœ… Atletas pueden ser aprobados por coaches

### **Para el Backend (ya implementado):**
- [ ] âœ… Coaches se crean automÃ¡ticamente activos
- [ ] âœ… Admins tambiÃ©n pueden aprobar atletas
- [ ] âœ… Validaciones de estado activo
- [ ] âœ… Script SQL para coaches existentes

---

## ğŸ¯ **RESUMEN**

**El problema era del BACKEND y ya estÃ¡ RESUELTO:**

1. **âœ… Coaches se crean automÃ¡ticamente activos**
2. **âœ… Coaches pueden aprobar atletas**
3. **âœ… Admins tambiÃ©n pueden aprobar atletas**
4. **âœ… Validaciones mejoradas**

**El frontend NO necesita cambios. Solo probar que ahora funciona correctamente.** ğŸ‰ 